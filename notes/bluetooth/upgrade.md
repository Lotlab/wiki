title: 蓝牙键盘固件更新教程
category: 教程
time: 1573917937290

---

## 概述

你可能需要升级固件来获得新功能或者修复已有的BUG，可供更新的固件可以在产品页面最下方的固件发布处找到。

此系列键盘的固件一般分为蓝牙固件和USB固件。蓝牙固件的文件名形如`[键盘名称]_nrf52_[编译日期]_[Git版本].zip`，USB固件的文件名形如`[键盘名称]_ch554_[编译日期]_[Git版本].hex`。

USB固件和蓝牙固件有着一一对应的关系，必须同时更新。如果当前固件版本没有包含USB固件或蓝牙固件，则可以只更新一个。如果你在进行跨版本升级，请确认两个固件都升级到最后发布的版本。

## 更新蓝牙固件

### 更新警告

- **刷入不正确的固件可能会使得你的键盘损坏！**
- 请在更新前确认升级包是由可信的人员提供的。
- 请在更新前阅读固件发布页面的详细说明，了解可能出现的问题；
- 升级包可能包含蓝牙栈(SoftDevice)或引导程序(Bootloader)，刷入错误的蓝牙栈或引导程序将会使固件更新功能完全不可用。在这种情况下，您必须使用SWD接口烧录正确的蓝牙栈、引导程序和程序，才能使键盘恢复正常工作。
- 如果您刷入了错误的程序(Application)而无法进入DFU模式，请参考产品页面的相关说明，**强行进入DFU模式**然后更新。

### 通常更新方法

1. 使用手机安装并打开 nRF Connect[^1] 程序
2. 点击nRF Connect右上角的Scan扫描蓝牙设备，这时候应该能够见到你的蓝牙键盘
3. 点击CONNCET按钮，等待连接成功
4. 点击右上角的DFU按钮，选择第一个Distribution packet(ZIP)，然后选择刚刚下载的蓝牙固件包
5. 静静的等待升级完毕即可

刷新完成后可能要手工在手机或电脑上取消配对并重新配对才可继续使用

### 特殊更新方法

如果在点击DFU后出现问题，无法继续刷新。可以在请参考产品页面的相关说明，**进入DFU模式**后尝试以下步骤。

1. 点击nRF Connect右上角的Scan扫描蓝牙设备，这时应该会找到一个叫做DfuTarg的蓝牙设备
2. 按照上面的3-5步再做一遍。

### 常见问题

1. Q: 我在点击DFU后，没有出现固件刷新进度的界面. A: 尝试使用特殊更新方法更新
2. Q: 我不小心进入了DFU模式，要怎么退出呢？A: 等待90秒后，DFU模式会自动退出

## 更新USB固件

### 更新警告

- **刷入不正确的USB固件可能使你的键盘的USB功能工作不正常**
- 请在更新前确认此固件是由可信的人员提供的。
- 请在更新前阅读固件发布页面的详细说明，了解可能出现的问题；
- 若在更新完毕后发现USB功能不可用，可以参考下面的刷新说明重新刷新。

### 更新方法

1. 至WCH官网下载[固件更新工具](http://www.wch.cn/downloads/WCHISPTool_Setup_exe.html)[^2]
2. 打开固件更新工具，切换至“8位ch55x系列”，将芯片型号改为“CH552”，并在底下的“用户程序文件中”选择你要更新的USB固件
3. 参考产品说明，**进入USB ISP模式**，此时，设备列表中会出现一个可选择的设备并会自动选中。
4. 点击下载按钮。下载完毕后，将键盘的USB断开并重新连接，即可升级完毕。


[^1]: 可以到 [官方下载页面](http://www.nordicsemi.com/eng/Products/Nordic-mobile-Apps/nRF-Connect-for-mobile-previously-called-nRF-Master-Control-Panel) 或者应用商店搜索下载。支持IOS和安卓端。
[^2]: 可以使用[官方的固件更新工具](http://www.wch.cn/downloads/WCHISPTool_Setup_exe.html)。若你在使用Linux，则可以使用三方的[WCHISP](https://github.com/rgwan/librech551)来更新。
